const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./loader-CkLCe-E_-Bl9WPIkH.js","./story-B9xumwLI.js","./main-BtP7c6vW.js","./main-Blpl9308.css","./story-LhlHeSxL.css","./mat4f64-Dn1WEGBx-C99QVUMW.js","./enums-DBi1-Mm2-CUS1pvQe.js","./Version-CoKzbupV-DLh72U_t.js","./mat4-DX7gBViE-Bu0k1ptY.js","./common-CYWrYyJl-E8-sukrT.js","./quat-BODLR7mS-Bz-V93fu.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./quatf64-C16JxGFv-BKWK1F8U.js","./vec32-D9GsKZ1t-DPI2vtMb.js","./vec42-D8CJyqHG-DnfLTeQH.js","./BufferView-PQoE3GL7-_yagYDLf.js","./vec2-tHZ6OaOy-xCj1obDt.js","./resourceUtils-Ds65naCv-CbLbeRT4.js","./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js"])))=>i.map(i=>d[i]);
import{_ as Mt}from"./main-BtP7c6vW.js";import{m as _t}from"./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js";import{is as dt,it as W,hf as st,k3 as Ot,b6 as ft,f as Rt,W as pt,o as Bt,il as it,dg as U,a1 as Pt,hB as Ct}from"./story-B9xumwLI.js";import{U as Et,P as St,E as ot}from"./mat3-CC4Foazl-BWjyqE2v.js";import{n as gt,o as J}from"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import{z as Lt}from"./mat4-DX7gBViE-Bu0k1ptY.js";import{t as Nt,u as nt,o as Ft}from"./mat4f64-Dn1WEGBx-C99QVUMW.js";import{l as Ut}from"./vec2f64-CeODonrJ-CkkJCdRC.js";import{Y as tt,r as Gt,x as at,b as $t,l as kt,X as qt,_ as L,j as C,L as N,B as jt}from"./vec32-D9GsKZ1t-DPI2vtMb.js";import{ab as Dt,ac as Ht,g as X,ad as Vt,a3 as zt,aa as H,s as Wt,ae as V,a9 as Xt,a4 as Qt,p as xt}from"./AttributeArray-BWXEft_i-Bomhkk8m.js";import{X as Kt,L as bt,C as Zt,l as yt,g as Jt,M as Yt}from"./BufferView-PQoE3GL7-_yagYDLf.js";import{b as te,z as ee,O as ut,j as lt}from"./vec3-BazNroeq-CMPN2S9E.js";import{L as re,P as ct}from"./vec4-DWDdg1fj-CbUaMZSH.js";import{U as se,k as $,E as ie,c as oe,y as ne,d as ae}from"./DefaultMaterial_COLOR_GAMMA-D0o2czi9-B1lwM-XJ.js";import{f as Y}from"./resourceUtils-Ds65naCv-CbLbeRT4.js";import{f as ue,l as le}from"./vec2f32-CVhmN3Me-DxoqVD7C.js";import{s as ce}from"./NestedMap-Ddo7BfvO-BpVPk8mz.js";import{m as wt}from"./Version-CoKzbupV-DLh72U_t.js";import{w as me,A as vt}from"./Indices-DEr2HrWx-I_dyyj_T.js";import{r as he}from"./requestImageUtils-Ut4YcoNU-CaomcTrq.js";import{M as q}from"./orientedBoundingBox-oHezdpWm-Bs4tdbUK.js";import{N as O,s as de,e as et,u as fe}from"./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js";import{_ as pe}from"./triangle-hqU-Tc1X-D3htKteF.js";import{h as ge}from"./Util-BjGjeg6f-08Szkf4F.js";import{T}from"./VertexAttribute-DqD5S0a2-3q90nikV.js";import{G as mt}from"./enums-DBi1-Mm2-CUS1pvQe.js";import{t as ht}from"./NormalAttribute.glsl-axtNsUxo-BboWpb6z.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./Texture-BCt2hphT-m09X6G6Y.js";import"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import"./InterleavedLayout-DXzw3B2n-wCUmD6HG.js";import"./types-ChhhI6OU-Cxh6dPlX.js";import"./compilerUtils-CV1QYWI8-CkfvNaG6.js";import"./interfaces-DN2-jsJC-DzMTiT5R.js";import"./BindType-9iOk18Ed-CRW1cdX4.js";import"./AlphaCutoff-ZPx1GqOi-UcccL64p.js";import"./boundedPlane-DlvE0eNx-DmsJdMr7.js";import"./sphere-BenPORjV-Cd7zoi35.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-hf2nxvhQ-CaAr8PTM.js";import"./plane-Dt8R0KeE-B4NOPu40.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./lineSegment-CcqvCARM-BsxqM6HA.js";import"./renderState-Dap0WV9P-D4IHxyei.js";import"./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js";import"./lengthUtils-DKpMe5qR-D3zwdNc6.js";import"./vec2-tHZ6OaOy-xCj1obDt.js";import"./projectBuffer-CvCBvJ6W-wbw8juri.js";import"./quat-BODLR7mS-Bz-V93fu.js";import"./spatialReferenceEllipsoidUtils-DUrKTvup-Caz6uGa1.js";import"./computeTranslationToOriginAndRotation-wF0y9WQG-CROcJWW7.js";function xe(i,t){if(!i)return!1;const{size:e,data:r,indices:l}=i;L(t,0,0,0),L(v,0,0,0);let u=0,o=0;for(let a=0;a<l.length-2;a+=3){const c=l[a]*e,s=l[a+1]*e,n=l[a+2]*e;L(g,r[c],r[c+1],r[c+2]),L(E,r[s],r[s+1],r[s+2]),L(z,r[n],r[n+1],r[n+2]);const m=pe(g,E,z);m?(C(g,g,E),C(g,g,z),N(g,g,1/3*m),C(t,t,g),u+=m):(C(v,v,g),C(v,v,E),C(v,v,z),o+=3)}return(o!==0||u!==0)&&(u!==0?(N(t,t,1/u),!0):o!==0&&(N(t,v,1/o),!0))}function be(i,t){if(!i)return!1;const{size:e,data:r,indices:l}=i;L(t,0,0,0);let u=-1,o=0;for(let a=0;a<l.length;a++){const c=l[a]*e;u!==c&&(t[0]+=r[c],t[1]+=r[c+1],t[2]+=r[c+2],o++),u=c}return o>1&&N(t,t,1/o),o>0}function ye(i,t,e){if(!i)return!1;L(e,0,0,0),L(v,0,0,0);let r=0,l=0;const{size:u,data:o,indices:a}=i,c=a.length-1,s=c+(t?2:0);for(let n=0;n<s;n+=2){const m=n<c?n+1:0,d=a[n<c?n:c]*u,f=a[m]*u;g[0]=o[d],g[1]=o[d+1],g[2]=o[d+2],E[0]=o[f],E[1]=o[f+1],E[2]=o[f+2],N(g,C(g,g,E),.5);const h=jt(g,E);h>0?(C(e,e,N(g,g,h)),r+=h):r===0&&(C(v,v,g),l++)}return r!==0?(N(e,e,1/r),!0):l!==0&&(N(e,v,1/l),!0)}const g=U(),E=U(),z=U(),v=U();class we{constructor(){this.uid=Ct()}}class ve extends we{constructor(t){super(),this.highlightGroupName=t,this.channel=fe.Highlight}}class Q extends Wt{constructor(t,e,r=null,l=V.Mesh,u=null,o=-1){super(),this.material=t,this.mapPositions=r,this.type=l,this.objectAndLayerIdColor=u,this.edgeIndicesLength=o,this.highlights=new Set,this._highlightGroupCounts=new Map,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[a,c]of e)this._attributes.set(a,{...c,indices:me(c.indices)}),a===T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(a).indices.length:this.edgeIndicesLength)}instantiate(t={}){const e=new Q(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,l)=>{r.exclusive=!1,e._attributes.set(l,r)}),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}get attributes(){return this._attributes}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e={...e,exclusive:!0,data:Xt(e.data)},this._attributes.set(t,e)),e}setAttributeData(t,e){const r=this._attributes.get(t);r&&this._attributes.set(t,{...r,exclusive:!0,data:e})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===V.Mesh?this._computeAttachmentOriginTriangles(t):this.type===V.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&tt(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){const e=this.attributes.get(T.POSITION);return xe(e,t)}_computeAttachmentOriginLines(t){const e=this.attributes.get(T.POSITION);return ye(e,Te(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){const e=this.attributes.get(T.POSITION);return be(e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.attributes.get(T.POSITION);if(!t||t.indices.length===0)return null;const e=this.type===V.Mesh?3:1;ge(t.indices.length%e==0,"Indexing error: "+t.indices.length+" not divisible by "+e);const r=vt(t.indices.length/e);return new Qt(r,e,t)}get transformation(){return this._transformation??nt}set transformation(t){this._transformation=t&&t!==nt?Ft(t):null}get highlightGroups(){return this._highlightGroupCounts}get hasHighlights(){return this._highlightGroupCounts.size>0}foreachHighlightGroup(t){this._highlightGroupCounts.forEach((e,r)=>t(r))}allocateIdAndHighlight(t){const e=new ve(t);return this.addHighlight(e)}addHighlight(t){this.highlights.add(t);const{highlightGroupName:e}=t,r=(this._highlightGroupCounts.get(e)??0)+1;return this._highlightGroupCounts.set(e,r),t}removeHighlight(t){if(this.highlights.delete(t)){const{highlightGroupName:e}=t,r=this._highlightGroupCounts.get(e)??0;r<=1?this._highlightGroupCounts.delete(e):this._highlightGroupCounts.set(e,r-1)}}}function Te(i,t){return!(!("isClosed"in i)||!i.isClosed)&&t.indices.length>2}function j(i){if(i==null)return null;const t=i.offset!=null?i.offset:ue,e=i.rotation!=null?i.rotation:0,r=i.scale!=null?i.scale:le,l=J(1,0,0,0,1,0,t[0],t[1],1),u=J(Math.cos(e),-Math.sin(e),0,Math.sin(e),Math.cos(e),0,0,0,1),o=J(r[0],0,0,0,r[1],0,0,0,1),a=gt();return ot(a,u,o),ot(a,l,a),a}class Ie{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class Ae{constructor(t,e,r){this.name=t,this.lodThreshold=e,this.pivotOffset=r,this.stageResources=new Ie,this.numberOfVertices=0}}const P=()=>Pt.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function Me(i,t){const e=await _e(i,t),r=await Ce(e.textureDefinitions??{},t);let l=0;for(const u in r)if(r.hasOwnProperty(u)){const o=r[u];l+=o?.image?o.image.width*o.image.height*4:0}return{resource:e,textures:r,size:l+Ot(e)}}async function _e(i,t){const e=t?.streamDataRequester;if(e)return Oe(i,e,t);const r=await ft(Rt(i,t));if(r.ok===!0)return r.value.data;pt(r.error),Tt(r.error)}async function Oe(i,t,e){const r=await ft(t.request(i,"json",e));if(r.ok===!0)return r.value;pt(r.error),Tt(r.error.details.url)}function Tt(i){throw new Bt("",`Request for object resource failed: ${i}`)}function Re(i){const t=i.params,e=t.topology;let r=!0;switch(t.vertexAttributes||(P().warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const u=t.faces;if(u){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=u[o];a?.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(P().warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(P().warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(P().warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else P().warn("Indexed geometries must specify faces"),r=!1;break}default:P().warn(`Unsupported topology '${e}'`),r=!1}i.params.material||(P().warn("Geometry requires material"),r=!1);const l=i.params.vertexAttributes;for(const u in l)l[u].values||(P().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Be(i,t){const e=new Array,r=new Array,l=new Array,u=new ce,o=i.resource,a=wt.parse(o.version||"1.0","wosr");Se.validate(a);const c=o.model.name,s=o.model.geometries,n=o.materialDefinitions??{},m=i.textures;let d=0;const f=new Map;for(let h=0;h<s.length;h++){const p=s[h];if(!Re(p))continue;const b=Ee(p),I=p.params.vertexAttributes,M=[],A=x=>{if(p.params.topology==="PerAttributeArray")return null;const _=p.params.faces;for(const B in _)if(B===x)return _[B].values;return null},G=I[T.POSITION],D=G.values.length/G.valuesPerElement;for(const x in I){const _=I[x],B=_.values,Z=A(x)??vt(D);M.push([x,new q(B,Z,_.valuesPerElement,!0)])}const R=b.texture,y=m&&m[R];if(y&&!f.has(R)){const{image:x,parameters:_}=y,B=new xt(x,_);r.push(B),f.set(R,B)}const F=f.get(R),K=F?F.id:void 0,S=b.material;let w=u.get(S,R);if(w==null){const x=n[S.slice(S.lastIndexOf("/")+1)].params;x.transparency===1&&(x.transparency=0);const _=y&&y.alphaChannelUsage,B=x.transparency>0||_==="transparency"||_==="maskAndTransparency",Z=y?It(y.alphaChannelUsage):void 0,rt={ambient:it(x.diffuse),diffuse:it(x.diffuse),opacity:1-(x.transparency||0),transparent:B,textureAlphaMode:Z,textureAlphaCutoff:.33,textureId:K,initTextureTransparent:!0,doubleSided:!0,cullFace:et.None,colorMixMode:x.externalColorMixMode||"tint",textureAlphaPremultiplied:y?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(rt,t.materialParameters),w=new X(rt,t),u.set(S,R,w)}l.push(w);const At=new Q(w,M);d+=M.find(x=>x[0]===T.POSITION)?.[1]?.indices.length??0,e.push(At)}return{engineResources:[{name:c,stageResources:{textures:r,materials:l,geometries:e},pivotOffset:o.model.pivotOffset,numberOfVertices:d,lodThreshold:null}],referenceBoundingBox:Pe(e)}}function Pe(i){const t=dt();return i.forEach(e=>{const r=e.boundingInfo;r!=null&&(W(t,r.bbMin),W(t,r.bbMax))}),t}async function Ce(i,t){const e=new Array;for(const u in i){const o=i[u],a=o.images[0].data;if(!a){P().warn("Externally referenced texture data is not yet supported");continue}const c=o.encoding+";base64,"+a,s="/textureDefinitions/"+u,n=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",m={noUnpackFlip:!0,wrap:{s:mt.REPEAT,t:mt.REPEAT},preMultiplyAlpha:It(n)!==O.Opaque},d=t?.disableTextures?Promise.resolve(null):he(c,t);e.push(d.then(f=>({refId:s,image:f,parameters:m,alphaChannelUsage:n})))}const r=await Promise.all(e),l={};for(const u of r)l[u.refId]=u;return l}function It(i){switch(i){case"mask":return O.Mask;case"maskAndTransparency":return O.MaskBlend;case"none":return O.Opaque;default:return O.Blend}}function Ee(i){const t=i.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Se=new wt(1,2,"wosr");async function Ur(i,t){const e=Le(_t(i));if(e.fileType==="wosr"){const m=await(t.cache?t.cache.loadWOSR(e.url,t):Me(e.url,t)),{engineResources:d,referenceBoundingBox:f}=Be(m,t);return{lods:d,referenceBoundingBox:f,isEsriSymbolResource:!1,isWosr:!0}}let r;if(t.cache)r=await t.cache.loadGLTF(e.url,t,!!t.usePBR);else{const{loadGLTF:m}=await Mt(()=>import("./loader-CkLCe-E_-Bl9WPIkH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url);r=await m(new se(t.streamDataRequester),e.url,t,t.usePBR)}const l=r.model.meta?.ESRI_proxyEllipsoid,u=r.meta.isEsriSymbolResource&&l!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";u&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,$e(r,l));const o=!!t.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:u,mrrFactors:Dt}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:Ht},c={...t.materialParameters,treeRendering:u},{engineResources:s,referenceBoundingBox:n}=Ne(r,a,c,t,e.specifiedLodIndex);return{lods:s,referenceBoundingBox:n,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function Le(i){const t=i.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:i.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:i,specifiedLodIndex:null}:{fileType:"unknown",url:i,specifiedLodIndex:null}}function Ne(i,t,e,r,l){const u=i.model,o=new Array,a=new Map,c=new Map,s=u.lods.length,n=dt();return u.lods.forEach((m,d)=>{const f=r.skipHighLods===!0&&(s>1&&d===0||s>3&&d===1)||r.skipHighLods===!1&&l!=null&&d!==l;if(f&&d!==0)return;const h=new Ae(m.name,m.lodThreshold,[0,0,0]);m.parts.forEach(p=>{const b=f?new X({},r):Fe(u,p,h,t,e,a,c,r),{geometry:I,vertexCount:M}=Ue(p,b??new X({},r)),A=I.boundingInfo;A!=null&&d===0&&(W(n,A.bbMin),W(n,A.bbMax)),b!=null&&(h.stageResources.geometries.push(I),h.numberOfVertices+=M)}),f||o.push(h)}),{engineResources:o,referenceBoundingBox:n}}function Fe(i,t,e,r,l,u,o,a){const c=t.material+(t.attributes.normal?"_normal":"")+(t.attributes.color?"_color":"")+(t.attributes.texCoord0?"_texCoord0":"")+(t.attributes.tangent?"_tangent":""),s=i.materials.get(t.material),n=t.attributes.texCoord0!=null,m=t.attributes.normal!=null;if(s==null)return null;const d=Ge(s.alphaMode);if(!u.has(c)){if(n){const y=(F,K=!1)=>{if(F!=null&&!o.has(F)){const S=i.textures.get(F);if(S!=null){const w=S.data;o.set(F,new xt(Y(w)?w.data:w,{...S.parameters,preMultiplyAlpha:!Y(w)&&K,encoding:Y(w)&&w.encoding!=null?w.encoding:void 0}))}}};y(s.textureColor,d!==O.Opaque),y(s.textureNormal),y(s.textureOcclusion),y(s.textureEmissive),y(s.textureMetallicRoughness)}const h=s.color[0]**(1/$),p=s.color[1]**(1/$),b=s.color[2]**(1/$),I=s.emissiveFactor[0]**(1/$),M=s.emissiveFactor[1]**(1/$),A=s.emissiveFactor[2]**(1/$),G=s.textureColor!=null&&n?o.get(s.textureColor):null,D=Vt({normalTexture:s.textureNormal,metallicRoughnessTexture:s.textureMetallicRoughness,metallicFactor:s.metallicFactor,roughnessFactor:s.roughnessFactor,emissiveTexture:s.textureEmissive,emissiveFactor:s.emissiveFactor,occlusionTexture:s.textureOcclusion}),R=s.normalTextureTransform?.scale!=null?s.normalTextureTransform?.scale:Ut;u.set(c,new X({...r,transparent:d===O.Blend,customDepthTest:de.Lequal,textureAlphaMode:d,textureAlphaCutoff:s.alphaCutoff,diffuse:[h,p,b],ambient:[h,p,b],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?et.None:et.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:m?ht.Attribute:ht.ScreenDerivative,castShadows:!0,receiveShadows:s.receiveShadows,receiveAmbientOcclusion:s.receiveAmbientOcclustion,textureId:G?.id,colorMixMode:s.colorMixMode,normalTextureId:s.textureNormal!=null&&n?o.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:G!=null&&!!G.parameters.preMultiplyAlpha,occlusionTextureId:s.textureOcclusion!=null&&n?o.get(s.textureOcclusion).id:void 0,emissiveTextureId:s.textureEmissive!=null&&n?o.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:s.textureMetallicRoughness!=null&&n?o.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[I,M,A],mrrFactors:D?zt:[s.metallicFactor,s.roughnessFactor,r.mrrFactors[2]],isSchematic:D,colorTextureTransformMatrix:j(s.colorTextureTransform),normalTextureTransformMatrix:j(s.normalTextureTransform),scale:[R[0],R[1]],occlusionTextureTransformMatrix:j(s.occlusionTextureTransform),emissiveTextureTransformMatrix:j(s.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:j(s.metallicRoughnessTextureTransform),...l},a))}const f=u.get(c);if(e.stageResources.materials.push(f),n){const h=p=>{p!=null&&e.stageResources.textures.push(o.get(p))};h(s.textureColor),h(s.textureNormal),h(s.textureOcclusion),h(s.textureEmissive),h(s.textureMetallicRoughness)}return f}function Ue(i,t){const e=i.attributes.position.count,r=ie(i.indices||e,i.primitiveType),l=H(3*e),{typedBuffer:u,typedBufferStride:o}=i.attributes.position;te(l,u,i.transform,3,o);const a=[[T.POSITION,new q(l,r,3,!0)]];if(i.attributes.normal!=null){const s=H(3*e),{typedBuffer:n,typedBufferStride:m}=i.attributes.normal;Et(k,i.transform),ee(s,n,k,3,m),st(k)&&ut(s,s),a.push([T.NORMAL,new q(s,r,3,!0)])}if(i.attributes.tangent!=null){const s=H(4*e),{typedBuffer:n,typedBufferStride:m}=i.attributes.tangent;St(k,i.transform),re(s,n,k,4,m),st(k)&&ut(s,s,4),a.push([T.TANGENT,new q(s,r,4,!0)])}if(i.attributes.texCoord0!=null){const s=H(2*e),{typedBuffer:n,typedBufferStride:m}=i.attributes.texCoord0;oe(s,n,2,m),a.push([T.UV0,new q(s,r,2,!0)])}const c=i.attributes.color;if(c!=null){const s=new Uint8Array(4*e);c.elementCount===4?c instanceof Kt?ct(s,c,255):c instanceof bt?ne(s,c):c instanceof Zt&&ct(s,c,1/256):(s.fill(255),c instanceof yt?lt(s,c.typedBuffer,255,4,c.typedBufferStride):i.attributes.color instanceof Jt?ae(s,c.typedBuffer,4,i.attributes.color.typedBufferStride):i.attributes.color instanceof Yt&&lt(s,c.typedBuffer,1/256,4,c.typedBufferStride)),a.push([T.COLOR,new q(s,r,4,!0)])}return{geometry:new Q(t,a),vertexCount:e}}const k=gt();function Ge(i){switch(i){case"BLEND":return O.Blend;case"MASK":return O.Mask;case"OPAQUE":case null:case void 0:return O.Opaque}}function $e(i,t){for(let e=0;e<i.model.lods.length;++e){const r=i.model.lods[e];for(const l of r.parts){const u=l.attributes.normal;if(u==null)return;const o=l.attributes.position,a=o.count,c=U(),s=U(),n=U(),m=new Uint8Array(4*a),d=new Float64Array(3*a),f=Lt(Nt(),l.transform);let h=0,p=0;for(let b=0;b<a;b++){o.getVec(b,s),u.getVec(b,c),tt(s,s,l.transform),Gt(n,s,t.center),at(n,n,t.radius);const I=n[2],M=$t(n),A=Math.min(.45+.55*M*M,1);at(n,n,t.radius),f!==null&&tt(n,n,f),kt(n,n),e+1!==i.model.lods.length&&i.model.lods.length>1&&qt(n,n,c,I>-1?.2:Math.min(-4*I-3.8,1)),d[h]=n[0],d[h+1]=n[1],d[h+2]=n[2],h+=3,m[p]=255*A,m[p+1]=255*A,m[p+2]=255*A,m[p+3]=255,p+=4}l.attributes.normal=new yt(d),l.attributes.color=new bt(m)}}}export{Ur as fetch,Le as parseUrl};
